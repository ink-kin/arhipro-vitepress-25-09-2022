---
title: Проект asciinema
date: 2020/12/09 13:41:55
cover_index: "http://picsum.photos/450/450?random=23"
tags:
categories:
- Innovate
- httpsBuilding
---

Проект asciinema состоит из нескольких взаимодополняющих частей:

- регистратор сеансов терминала на основе командной строки asciinema,
- сайт с API на asciinema.org,
- проигрыватель javascript
Когда вы запускаете asciinema recв своем терминале, начинается запись, фиксирующая весь вывод, который выводится на ваш терминал, пока вы вводите команды оболочки. По окончании записи (нажатием Ctrl-Dили вводом exit) захваченный результат загружается на веб-сайт asciinema.org и готов к воспроизведению в Интернете.

Вот краткий обзор того, как работают эти части.

<!-- more -->

## Запись
{% asciinema 378274 %}
Вы , наверное , знаете ssh, screen или script команда. Собственно, asciinema был вдохновлен командами script(и scriptreplay). Вы можете не знать, что все они используют одну и ту же возможность системы UNIX: (псевдотерминал)http://en.wikipedia.org/wiki/Pseudo_terminal .

> Псевдотерминал - это пара псевдоустройств, одно из которых, подчиненное устройство, эмулирует реальное устройство текстового терминала, а другое, ведущее устройство, обеспечивает средства, с помощью которых процесс эмулятора терминала управляет подчиненным устройством.

Вот как эмулятор терминала взаимодействует с пользователем и оболочкой:

> Роль процесса эмулятора терминала - взаимодействие с пользователем; > для подачи вводимого текста в главное псевдоустройство для использования оболочкой (которая подключена к подчиненному псевдоустройству), а также для чтения текста, выводимого с главного псевдоустройства, и отображения его пользователю.

Другими словами, псевдотерминалы дают программам возможность действовать как посредники между пользователем, дисплеем и оболочкой. Он обеспечивает прозрачный захват пользовательского ввода (клавиатура) и вывода терминала (дисплей). screenкоманда использует его для захвата специальных сочетаний клавиш, таких как Ctrl-Aи изменения вывода, чтобы отображать номера / имена окон и другие сообщения.

asciinema Recorder выполняет свою работу, используя псевдотерминал для захвата всего вывода, который поступает на терминал, и сохранения его в памяти (вместе с информацией о времени). Захваченный вывод включает в себя весь текст и невидимые управляющие / управляющие последовательности в необработанном, неизмененном виде. Когда сеанс записи завершается, он загружает вывод (в (формате asciicast)https://github.com/asciinema/asciinema/blob/master/doc/asciicast-v1.md ) на asciinema.org. Это все о «записывающей» части.

Подробности реализации смотрите в (исходном коде рекордера)https://github.com/asciinema/asciinema .

## Воспроизведение

Поскольку запись представляет собой необработанный поток текста и управляющих последовательностей, ее нельзя просто воспроизвести путем постепенной печати текста через определенные интервалы. Это требует интерпретации (последовательностей управляющих кодов ANSI)http://en.wikipedia.org/wiki/ANSI_escape_code , чтобы правильно отображать изменения цвета, перемещение курсора и печать текста в нужных местах на экране.

Плеер поставляется с собственным эмулятором терминала, основанным на (парсере Пола Вильямса для ANSI-совместимых видеотерминалов)https://vt100.net/emu/dec_ansi_parser . Он охватывает только отображаемую часть эмуляции, так как это то, чем занимается проигрыватель (в любом случае ввод обрабатывается вашим терминалом + оболочкой во время записи), а его обработка escape-последовательностей полностью совместима с большинством современных эмуляторов терминала, таких как xterm, Терминал Gnome, iTerm, mosh и т. Д.

Конечным результатом является плавная анимация со всеми атрибутами текста (полужирный, подчеркивание, инверсия и т. Д.) И 256 цветами, идеально обработанными.

Для деталей реализации проверить (сайт asciinema.org исходный код)https://github.com/asciinema/asciinema-server и (исходный код проигрывателя)https://github.com/asciinema/asciinema-player .

## Начем!

## 1. Установите регистратор

Установите asciinema с помощью: 

    brew install asciinema

Смотрите другие варианты установки. 

## 2. Запись

Чтобы начать запись, выполните следующую команду: 

    asciinema rec

Это порождает новый экземпляр оболочки и записывает весь вывод терминала. Когда вы будете готовы закончить, просто выйдите из оболочки, набрав exit или нажав Ctrl-D. 

См. Инструкции  по использованию, чтобы узнать обо всех командах и параметрах. 

## 3. Управляйте своими записями (необязательно)

Если вы хотите управлять своими записями на asciinema.org (установить заголовок / описание, удалить и т. Д.), Вам необходимо пройти аутентификацию. Выполните следующую команду и откройте отображаемый URL-адрес в своем веб-браузере: 

    asciinema auth

Если вы пропустите этот шаг сейчас, вы можете запустить указанную выше команду позже, и все ранее записанные асциаданные сообщения будут автоматически назначены вашему профилю. 

 
## Другие варианты установки

Если вы используете другую операционную систему и можете создать для нее собственный пакет, не сомневайтесь, сделайте это и дайте нам знать. У нас есть (проблема)https://github.com/asciinema/asciinema/issues/116 с Github, по которой мы отслеживаем новые выпуски и прогресс упаковки.

## Установка через Pip

asciinema доступен на (PyPI)https://pypi.python.org/pypi/asciinema и может быть установлен с помощью pip (требуется Python 3):

    sudo pip3 install asciinema

Это универсальный метод установки для всех операционных систем, который всегда предоставляет самую последнюю версию.

## Установка в Linux

### Arch Linux

    pacman -S asciinema

### Debian

    sudo apt-get install asciinema

### Fedora

Для Fedora <22:

    sudo yum install asciinema

Для Fedora> = 22:

    sudo dnf install asciinema

### Gentoo Linux

    emerge -av asciinema

### NixOS / Nix

    nix-env -i asciinema

### openSUSE

    zypper in asciinema

### Ubuntu

    sudo apt-add-repository ppa:zanchey/asciinema
    sudo apt-get update
    sudo apt-get install asciinema

## Установка на macOS

### Домашнее пиво

    brew install asciinema

### MacPorts

    sudo port selfupdate && sudo port install asciinema

### Nix

    nix-env -i asciinema

## Установка на FreeBSD

### Порты

    cd /usr/ports/textproc/py-asciinema && make install

### Пакеты

    pkg install py37-asciinema

## Установка на OpenBSD

    pkg_add asciinema

## Запуск в контейнере Docker

Образ asciinema Docker основан на Ubuntu 16.04 и имеет предустановленную последнюю версию записывающего устройства asciinema.

    docker pull asciinema/asciinema

При запуске не забудьте выделить псевдо-TTY ( -t), оставить STDIN открытым ( -i) и смонтировать конфигурационный каталог volume ( -v):

    docker run --rm -ti -v "$HOME/.config/asciinema":/root/.config/asciinema asciinema/asciinema

По умолчанию в контейнере запускается команда asciinema rec.

Однако в этом образе установлено не так много программного обеспечения. В большинстве случаев перед записью вы можете установить дополнительные программы. Один из вариантов - получить новый образ из этого (запустите свой собственный Dockerfile с FROM asciinema/asciinema). Другой вариант - запустить контейнер с /bin/bash помощью команды, установить дополнительные пакеты и запустить вручную asciinema rec:

    docker run --rm -ti -v "$HOME/.config/asciinema":/root/.config/asciinema asciinema/asciinema /bin/bash
    root@6689517d99a1:~# apt-get install foobar
    root@6689517d99a1:~# asciinema rec

## Запуск из источника

Если ничего из вышеперечисленного не работает для вас (или вы хотите помочь с разработкой), просто клонируйте репо и запустите последнюю версию asciinema прямо из основной ветки:

    git clone https://github.com/asciinema/asciinema.git
    cd asciinema
    python3 -m asciinema --version

# Применение

asciinema состоит из нескольких команд, похожих на git, apt-getили brew.

При запуске asciinemaбез аргументов отображается справочное сообщение, в котором перечислены все доступные команды с их параметрами.

## rec [filename] **Запись терминального сеанса.**

Запустив, asciinema rec [filename] вы запускаете новый сеанс записи. Записываемая команда (процесс) может быть указана с помощью -cпараметра (см. Ниже), и $SHELLв большинстве случаев это то, что вам нужно по умолчанию .

Запись заканчивается при выходе из снаряда (ударил Ctrl+Dили набрал exit). Если записанный процесс не является оболочкой, запись завершается, когда процесс завершается.

Если filename аргумент опущен, то (после запроса подтверждения) полученный asciicast загружается на asciinema-server по умолчанию на asciinema.org), где его можно просматривать и делиться.

Если filename указан аргумент, то результирующая запись (называемая asciicast) сохраняется в локальный файл. Позже его можно воспроизвести asciinema play или загрузить на сервер asciinema с помощью asciinema upload <filename>.

ASCIINEMA_REC=1добавляется к записанным переменным среды процесса. Это может использоваться конфигурационным файлом вашей оболочки ( .bashrc, .zshrc) для изменения подсказки или воспроизведения звука во время записи оболочки.

Доступные Варианты:
```
--stdin - Включить запись stdin (клавиатура) (см. Ниже)
--append - Добавить к существующей записи
--raw - Сохранение необработанного вывода STDOUT без информации о времени или других метаданных
--overwrite - Перезаписать запись, если она уже существует
-c, --command=<command> - Укажите команду для записи, по умолчанию $ SHELL
-e, --env=<var-names> - Список переменных среды для захвата, по умолчанию SHELL,TERM
-t, --title=<title> - Укажите заголовок аскикаста
-i, --idle-time-limit=<sec>- Ограничить записываемое бездействие терминала максимумом в <sec>секундах
-y, --yes - Ответьте «да» на все запросы (например, подтверждение загрузки)
-q, --quiet - Тихо, подавить все уведомления / предупреждения (подразумевает -y)
Запись по стандартному вводу позволяет записывать все символы, введенные пользователем в текущую записанную оболочку. Это может использоваться плеером (например, asciinema-player ) для отображения нажатых клавиш. Поскольку в основном это ведение журнала ключей (ограниченное одним экземпляром оболочки), оно отключено по умолчанию и должно быть явно включено с помощью --stdinпараметра.
```
Воспроизвести записанный asciicast в терминале.
```
play <filename>
```

Эта команда воспроизводит заданный asciicast (записанный recкомандой) прямо в вашем терминале.

Доступны следующие сочетания клавиш:

Space - переключить паузу,
. - пошагово выполнять запись по кадрам (при паузе),
Ctrl+C - Выход.
Воспроизведение из локального файла:

asciinema play /path/to/asciicast.cast
Воспроизведение с HTTP (S) URL:

asciinema play https://asciinema.org/a/22124.cast
asciinema play http://example.com/demo.cast
Воспроизведение с URL-адреса страницы asciicast
Для этого требуется
```
<link rel="alternate" type="application/x-asciicast" href="/my/ascii.cast">
```
в HTML- коде страницы ):
```
asciinema play https://asciinema.org/a/22124
asciinema play http://example.com/blog/post.html
```
### Игра со стандартного ввода:
```
cat /path/to/asciicast.cast | asciinema play -
ssh user@host cat asciicast.cast | asciinema play -
```
### Воспроизведение из IPFS:
```
asciinema play dweb:/ipfs/QmNe7FsYaHc9SaDEAEXbaagAzNw9cH7YbzN4xV7jV1MCzK/ascii.cast
```
### Доступные Варианты:
```
-i, --idle-time-limit=<sec>- Ограничить неактивность проигрываемого терминала максимум <sec>секундами
-s, --speed=<factor> - Скорость воспроизведения (может быть дробной)
```

Для наилучшего воспроизведения рекомендуется запускать asciinema play терминал размером не меньше, чем тот, который использовался для записи, поскольку отсутствует «перекодирование» управляющих последовательностей для нового размера терминала.
```
cat <filename>
```
Вывести на терминал полный вывод записанного asciicast.

При 
```
asciinema play <filename>
```
воспроизведении записанного сеанса с использованием информации о времени,
сохраненной в 
```
asciicast, asciinema cat <filename>
```
полный вывод (включая все escape-последовательности) немедленно выгружается на терминал.
```
asciinema cat existing.cast > output.txt
```
дает тот же результат, что и запись через 

```
asciinema rec --raw output.txt.
```
### upload
```
upload <filename>
```
Загрузите записанный asciicast на сайт asciinema.org.

Эта команда загружает заданный asciicast (записанный recкомандой) на asciinema.org, где его можно просмотреть и поделиться.
```
asciinema rec demo.cast
asciinema play demo.cast
asciinema upload demo.cast
```
Это хорошая комбинация, если вы хотите просмотреть asciicast перед публикацией на asciinema.org.

### auth

Свяжите свой идентификатор установки с учетной записью пользователя asciinema.org.

Если вы хотите управлять своими записями (изменить название / тему, удалить) на asciinema.org, вам необходимо связать свой «установочный идентификатор» с учетной записью пользователя asciinema.org.

Эта команда отображает URL-адрес, который нужно открыть в веб-браузере для этого. Вас могут попросить сначала войти в систему.

Идентификатор установки - это случайный идентификатор ( UUID v4 ), сгенерированный локально при первом запуске asciinema и сохраненный в $HOME/.config/asciinema/install-id. Его цель - подключить локальный компьютер к загруженным записям, чтобы впоследствии их можно было связать с учетной записью asciinema.org. Таким образом, мы отделяем загрузку от создания учетной записи, позволяя им происходить в любом порядке.

Новый идентификатор установки создается на каждой машине и каждой учетной записи пользователя системы, на которой вы используете asciinema, поэтому для того, чтобы хранить все записи под одной учетной записью asciinema.org, вам необходимо запустить asciinema authна всех этих машинах.

Версии asciinema до 2.0 ошибочно называли идентификатор установки «токеном API».


## Файл конфигурации
Вы можете настроить asciinema, создав файл конфигурации по адресу $HOME/.config/asciinema/config.

Конфигурация разделяется на секции ( [api], [record], [play]). Вот список всех доступных опций для каждого раздела:
```
[api]

; API server URL, default: https://asciinema.org
; If you run your own instance of asciinema-server then set its address here
; It can also be overriden by setting ASCIINEMA_API_URL environment variable
url = https://asciinema.example.com

[record]

; Command to record, default: $SHELL
command = /bin/bash -l

; Enable stdin (keyboard) recording, default: no
stdin = yes

; List of environment variables to capture, default: SHELL,TERM
env = SHELL,TERM,USER

; Limit recorded terminal inactivity to max n seconds, default: off
idle_time_limit = 2

; Answer "yes" to all interactive prompts, default: no
yes = true

; Be quiet, suppress all notices/warnings, default: no
quiet = true

[play]

; Playback speed (can be fractional), default: 1
speed = 2

; Limit replayed terminal inactivity to max n seconds, default: off
idle_time_limit = 1
```

Минимальный конфигурационный файл может выглядеть так:

```
[record]
idle_time_limit = 2
```
Расположение каталога конфигурации можно изменить, установив $ASCIINEMA_CONFIG_HOME переменную среды.

Если $XDG_CONFIG_HOMEустановлен в Linux, asciinema использует $XDG_CONFIG_HOME/asciinemaвместо $HOME/.config/asciinema.

Использовались версии asciinema до 1.1 $HOME/.asciinema. Если он у вас есть, вы должны mv $HOME/.asciinema $HOME/.config/asciinema.

## Совместное использование и встраивание
Вы можете поделиться любой записью, скопировав ее URL-адрес и отправив другу или разместив ее в социальной сети. asciinema.org поддерживает протоколы oEmbed / Open Graph / Twitter Card, отображая красивые эскизы, где это возможно.

Вы также можете легко встроить asciicast на любую HTML-страницу. Если вы хотите поместить запись в сообщение блога, документацию по проекту или слайды выступления на конференции, вы можете сделать это, скопировав один из встроенных скриптов.

Отправка ссылки
Вы можете получить ссылку на общий доступ для определенного asciicast, щелкнув ссылку «Поделиться» на странице asciicast.

Любой из параметров, перечисленных в разделе «Настройка воспроизведения» ниже, может быть добавлен к asciicast URL в качестве параметров запроса, например:
```
https://asciinema.org/a/14?t=25&speed=2&theme=solarized-dark
```

При переходе по этой ссылке воспроизведение начнется на 25-й секунде и будет воспроизводиться с удвоенной скоростью с использованием темы терминала Solarized Dark.

Встраивание ссылки на изображение
Встраивание в виде ссылки на изображение полезно в местах, где использование сценариев запрещено, например, в файле README проекта.

Вы можете получить встроенные фрагменты для определенного asciicast, нажав на ссылку «Поделиться» на странице asciicast.

Вот как они ищут asciicast 14:

HTML:

```
<a href="https://asciinema.org/a/14"><img src="https://asciinema.org/a/14.png" width="836"/></a>
```
Markdown:

```
[![asciicast](https://asciinema.org/a/14.png)](https://asciinema.org/a/14)
```

Вы можете передать дополнительные параметры (перечисленные ниже в разделе «Настройка воспроизведения») в связанный URL-адрес в качестве параметров запроса. Например, для автоматического запуска воспроизведения при открытии связанной страницы asciicast добавьте ?autoplay=1к URL asciicast в hrefатрибут:


```
<a href="https://asciinema.org/a/14?autoplay=1"><img src="https://asciinema.org/a/14.png" width="836"/></a>
```

Встраивание плеера
Если вы встраиваете на свою страницу или на сайт, который разрешает теги скриптов, вы можете использовать виджет полного проигрывателя.

Вы можете получить скрипт виджета для определенного asciicast, щелкнув ссылку «Вставить» на странице asciicast.

Выглядит это так:

```
<script src="https://asciinema.org/a/14.js" id="asciicast-14" async></script>
```
Плеер появляется прямо в том месте, куда вставлен скрипт. Давайте посмотрим на следующую разметку:

```
<p>This is some text.</p>
<script src="https://asciinema.org/a/14.js" id="asciicast-14" async></script>
<p>This is some other text.</p>
```
Плеер отображается между двумя абзацами как divэлемент с классом «asciicast».

Скрипт внедрения поддерживает все параметры настройки (см. Раздел ниже). Опцию можно указать, добавив ее как атрибут к тегу скрипта.data-option-name=”value”

Например, чтобы встроенный проигрыватель автоматически запускал воспроизведение при загрузке и использовал большой шрифт, используйте следующий скрипт:


```
<script src="https://asciinema.org/a/14.js" id="asciicast-14" async data-autoplay="true" data-size="big"></script>
```
## Настройка воспроизведения

Плеер поддерживает несколько параметров, управляющих поведением и внешним видом. Добавьте их в URL ( ?speed=2&theme=tango) или установите в качестве атрибутов данных во встроенном скрипте ( data-speed="2" data-theme="tango").

### т

tПараметр определяет время , в которое должно начинаться воспроизведение. По умолчанию t=0(играть с начала).

Принимаемые форматы: ss, mm:ss, hh:mm:ss.

ПРИМЕЧАНИЕ: когда tуказано, то autoplay=1подразумевается. Чтобы предотвратить автоматический запуск плеера, когда tопция установлена, вы должны явно указать autoplay=0.

### Автовоспроизведение

В autoplayпараметре определяет , воспроизведение автоматически запускается при загрузке проигрывателя. Допустимые значения:

* 0 / false - не запускать воспроизведение автоматически (по умолчанию)
* 1 / true - запускать воспроизведение автоматически

### предварительная нагрузка

В preloadпараметр определяет , игрок должен немедленно начать извлечение записи.

* 0 / false - не загружать запись предварительно, ждать действий пользователя
* 1 / true - предварительно загрузить запись

По умолчанию 1 для URL asciinema.org, 0 для встроенного скрипта.

### петля

loopОпция позволяет зацикливание воспроизведения. Этот вариант обычно сочетается с autoplayвариантом. Допустимые значения:

* 0 / false - отключить зацикливание (по умолчанию)
* 1 / true - включить цикл

### скорость

speedОпция изменяет скорость воспроизведения. По умолчанию скорость равна 1, что означает воспроизведение с неизменной исходной скоростью.

### размер

В sizeопции изменяет то размер шрифта терминала. Доступны 3 размера:

* маленький (по умолчанию)
* Средняя
* большой

### тема

themeОпция позволяет переопределение темы , используемой для терминала. По умолчанию используется тема, установленная автором asciicast (или «asciinema», если она не установлена ​​автором). Доступные темы:

* asciinema
* танго
* солнечно-темный
* солнечный свет
* монокай

### cols

colsПараметр позволяет переопределить ширину (в символах) эмулируемого терминала. По умолчанию используется ширина записанного терминала.

### ряды

rowsПараметр позволяет переопределение высоты (в строках) эмулируемый терминал. По умолчанию используется записанная высота терминала.

## oEmbed / Open Graph / Twitter Card

asciinema поддерживает API-интерфейсы (oEmbed)https://oembed.com/, (Open Graph)http://ogp.me/ и Twitter Cardhttps://developer.twitter.com/en/docs/tweets/optimize-with-cards/guides/getting-started . Когда вы публикуете asciicast в Twitter, Slack, Facebook, Google+ или любом другом сайте, поддерживающем один из этих API, asciicast представляется в расширенной форме (обычно с заголовком, автором, описанием и миниатюрой), ссылаясь на ваш запись на asciinema.org.
 
